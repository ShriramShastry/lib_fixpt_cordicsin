/*
 * File: ref_sin_fixpt.c
 *
 */
 // SPDX - License - Identifier: BSD - 3 - Clause
 //
 //Copyright(c) 2021 Intel Corporation.All rights reserved.
 //
 //Author : Shriram Shastry <malladi.sastry@linux.intel.com>

/* Include Files */
#include "ref_sin_fixpt.h"
#include <string.h>
#include <stdint.h>
#include "typedef.h"
#include <errno.h>


/* Function Definitions */
/*
 * function [cdcSinTh] = ref_sine_fixpt(thRadFxp)
 * Use Q12.20-bit quantized inputs and number of iterations to 10.
 *  Compare the fixed-point cordicsin function results to the
 *  results of the double-precision sin function.
 * +--------------+---------+----------+----------+---------+
 * |              |thRadFxp |cdcSinTh  |QthRadFxp |QcdcSinTh|
 * +--------------+---------+----------+----------+---------+
 * |    WordLength| 31      |  32      |12.20     | 3.29    |
 * |FractionLength| 20      |  29      |          |         |
 * +--------------+---------+----------+----------+---------+
 *  THD+N = 29*6 = 174
 * Arguments    : const int32_t thRadFxp[1024]
 *                int32_t cdcSinTh[1024]
 * Return Type  : void
 */
void ref_sine_fixpt(const int32_t thRadFxp[1024], int32_t cdcSinTh[1024])
{
  static const int32_t inpLUT[10] = { 421657428, 248918915, 131521918, 66762579,
    33510843, 16771758, 8387925, 4194219, 2097141, 1048575 };

  int32_t b_idx;
  int32_t b_yn;
  int32_t idx;
  int32_t th;
  int32_t xn;
  int32_t xtmp;
  int32_t ytmp;
  int32_t z;
  boolean_t negate;

  for (idx = 0; idx < 1024; idx++) {
    th = thRadFxp[idx];
    if (th > 1647099) {                               // +20
      if (((th - 3294199) & 1073741824) != 0) {
        z = (th - 3294199) | -1073741824;
      } else {
        z = (th - 3294199) & 1073741823;
      }

      if (z <= 1647099) {
        th = z;
        negate = 1U;
      } else {
        if (((th - 6588397) & 1073741824) != 0) {
          th = (th - 6588397) | -1073741824;
        } else {
          th = (th - 6588397) & 1073741823;
        }

        negate = 0U;
      }
    } else if (th < -1647099) {                         // -20
      if (((th + 3294199) & 1073741824) != 0) {
        z = (th + 3294199) | -1073741824;
      } else {
        z = (th + 3294199) & 1073741823;
      }

      if (z >= -1647099) {
        th = z;
        negate = 1U;
      } else {
        if (((th + 6588397) & 1073741824) != 0) {
          th = (th + 6588397) | -1073741824;
        } else {
          th = (th + 6588397) & 1073741823;
        }

        negate = 0U;
      }
    } else {
      negate = 0U;
    }

    th <<= 9;
    if ((th & 1073741824) != 0) {
      z = th | -1073741824;
    } else {
      z = th & 1073741823;
    }

    b_yn = 0;
    xn = 326016644;
    xtmp = 326016644;
    ytmp = 0;
    for (b_idx = 0; b_idx < 10; b_idx++) {
      if (z < 0) {                              // negative LookUp table
        th = z + inpLUT[b_idx];
        if ((th & 1073741824) != 0) {
          z = th | -1073741824;
        } else {
          z = th & 1073741823;
        }

        th = xn + ytmp;
        if ((th & 1073741824) != 0) {
          xn = th | -1073741824;
        } else {
          xn = th & 1073741823;
        }

        th = b_yn - xtmp;
        if ((th & 1073741824) != 0) {
          b_yn = th | -1073741824;
        } else {
          b_yn = th & 1073741823;
        }
      } else {
        th = z - inpLUT[b_idx];                 // positive LookUp table
        if ((th & 1073741824) != 0) {
          z = th | -1073741824;
        } else {
          z = th & 1073741823;
        }

        th = xn - ytmp;
        if ((th & 1073741824) != 0) {
          xn = th | -1073741824;
        } else {
          xn = th & 1073741823;
        }

        th = b_yn + xtmp;
        if ((th & 1073741824) != 0) {
          b_yn = th | -1073741824;
        } else {
          b_yn = th & 1073741823;
        }
      }

      th = xn >> (b_idx + 1);
      if ((th & 1073741824) != 0) {
        xtmp = th | -1073741824;
      } else {
        xtmp = th & 1073741823;
      }

      th = b_yn >> (b_idx + 1);
      if ((th & 1073741824) != 0) {
        ytmp = th | -1073741824;
      } else {
        ytmp = th & 1073741823;
      }
    }

    if (negate) {
      if ((-b_yn & 1073741824) != 0) {
        cdcSinTh[idx] = -b_yn | -1073741824;
      } else {
        cdcSinTh[idx] = -b_yn & 1073741823;
      }
    } else {
      cdcSinTh[idx] = b_yn;
    }
  }
}

/*
 * function thRadFxp = init_data_fixpt
 * Arguments    : int32_t thRadFxp[1024]
 * Return Type  : void
 * Input Q12.20
 */
void init_data_fixpt(int32_t thRadFxp[1024])
{
  static const int32_t iv[1024] = { 0, 6433, 12867, 19301, 25735, 32169, 38603,
    45037, 51471, 57905, 64339, 70773, 77207, 83641, 90075, 96509, 102943,
    109377, 115811, 122245, 128679, 135113, 141547, 147981, 154415, 160849,
    167283, 173717, 180151, 186585, 193019, 199453, 205887, 212321, 218755,
    225189, 231623, 238057, 244491, 250925, 257359, 263793, 270227, 276661,
    283095, 289529, 295963, 302397, 308831, 315265, 321699, 328133, 334567,
    341001, 347435, 353868, 360302, 366736, 373170, 379604, 386038, 392472,
    398906, 405340, 411774, 418208, 424642, 431076, 437510, 443944, 450378,
    456812, 463246, 469680, 476114, 482548, 488982, 495416, 501850, 508284,
    514718, 521152, 527586, 534020, 540454, 546888, 553322, 559756, 566190,
    572624, 579058, 585492, 591926, 598360, 604794, 611228, 617662, 624096,
    630530, 636964, 643398, 649832, 656266, 662700, 669134, 675568, 682002,
    688436, 694870, 701304, 707737, 714171, 720605, 727039, 733473, 739907,
    746341, 752775, 759209, 765643, 772077, 778511, 784945, 791379, 797813,
    804247, 810681, 817115, 823549, 829983, 836417, 842851, 849285, 855719,
    862153, 868587, 875021, 881455, 887889, 894323, 900757, 907191, 913625,
    920059, 926493, 932927, 939361, 945795, 952229, 958663, 965097, 971531,
    977965, 984399, 990833, 997267, 1003701, 1010135, 1016569, 1023003, 1029437,
    1035871, 1042305, 1048739, 1055173, 1061606, 1068040, 1074474, 1080908,
    1087342, 1093776, 1100210, 1106644, 1113078, 1119512, 1125946, 1132380,
    1138814, 1145248, 1151682, 1158116, 1164550, 1170984, 1177418, 1183852,
    1190286, 1196720, 1203154, 1209588, 1216022, 1222456, 1228890, 1235324,
    1241758, 1248192, 1254626, 1261060, 1267494, 1273928, 1280362, 1286796,
    1293230, 1299664, 1306098, 1312532, 1318966, 1325400, 1331834, 1338268,
    1344702, 1351136, 1357570, 1364004, 1370438, 1376872, 1383306, 1389740,
    1396174, 1402608, 1409042, 1415475, 1421909, 1428343, 1434777, 1441211,
    1447645, 1454079, 1460513, 1466947, 1473381, 1479815, 1486249, 1492683,
    1499117, 1505551, 1511985, 1518419, 1524853, 1531287, 1537721, 1544155,
    1550589, 1557023, 1563457, 1569891, 1576325, 1582759, 1589193, 1595627,
    1602061, 1608495, 1614929, 1621363, 1627797, 1634231, 1640665, 1647099,
    1653533, 1659967, 1666401, 1672835, 1679269, 1685703, 1692137, 1698571,
    1705005, 1711439, 1717873, 1724307, 1730741, 1737175, 1743609, 1750043,
    1756477, 1762911, 1769344, 1775778, 1782212, 1788646, 1795080, 1801514,
    1807948, 1814382, 1820816, 1827250, 1833684, 1840118, 1846552, 1852986,
    1859420, 1865854, 1872288, 1878722, 1885156, 1891590, 1898024, 1904458,
    1910892, 1917326, 1923760, 1930194, 1936628, 1943062, 1949496, 1955930,
    1962364, 1968798, 1975232, 1981666, 1988100, 1994534, 2000968, 2007402,
    2013836, 2020270, 2026704, 2033138, 2039572, 2046006, 2052440, 2058874,
    2065308, 2071742, 2078176, 2084610, 2091044, 2097478, 2103912, 2110346,
    2116779, 2123213, 2129647, 2136081, 2142515, 2148949, 2155383, 2161817,
    2168251, 2174685, 2181119, 2187553, 2193987, 2200421, 2206855, 2213289,
    2219723, 2226157, 2232591, 2239025, 2245459, 2251893, 2258327, 2264761,
    2271195, 2277629, 2284063, 2290497, 2296931, 2303365, 2309799, 2316233,
    2322667, 2329101, 2335535, 2341969, 2348403, 2354837, 2361271, 2367705,
    2374139, 2380573, 2387007, 2393441, 2399875, 2406309, 2412743, 2419177,
    2425611, 2432045, 2438479, 2444913, 2451347, 2457781, 2464215, 2470648,
    2477082, 2483516, 2489950, 2496384, 2502818, 2509252, 2515686, 2522120,
    2528554, 2534988, 2541422, 2547856, 2554290, 2560724, 2567158, 2573592,
    2580026, 2586460, 2592894, 2599328, 2605762, 2612196, 2618630, 2625064,
    2631498, 2637932, 2644366, 2650800, 2657234, 2663668, 2670102, 2676536,
    2682970, 2689404, 2695838, 2702272, 2708706, 2715140, 2721574, 2728008,
    2734442, 2740876, 2747310, 2753744, 2760178, 2766612, 2773046, 2779480,
    2785914, 2792348, 2798782, 2805216, 2811650, 2818084, 2824517, 2830951,
    2837385, 2843819, 2850253, 2856687, 2863121, 2869555, 2875989, 2882423,
    2888857, 2895291, 2901725, 2908159, 2914593, 2921027, 2927461, 2933895,
    2940329, 2946763, 2953197, 2959631, 2966065, 2972499, 2978933, 2985367,
    2991801, 2998235, 3004669, 3011103, 3017537, 3023971, 3030405, 3036839,
    3043273, 3049707, 3056141, 3062575, 3069009, 3075443, 3081877, 3088311,
    3094745, 3101179, 3107613, 3114047, 3120481, 3126915, 3133349, 3139783,
    3146217, 3152651, 3159085, 3165519, 3171953, 3178386, 3184820, 3191254,
    3197688, 3204122, 3210556, 3216990, 3223424, 3229858, 3236292, 3242726,
    3249160, 3255594, 3262028, 3268462, 3274896, 3281330, 3287764, 3294198,
    3300632, 3307066, 3313500, 3319934, 3326368, 3332802, 3339236, 3345670,
    3352104, 3358538, 3364972, 3371406, 3377840, 3384274, 3390708, 3397142,
    3403576, 3410010, 3416444, 3422878, 3429312, 3435746, 3442180, 3448614,
    3455048, 3461482, 3467916, 3474350, 3480784, 3487218, 3493652, 3500086,
    3506520, 3512954, 3519388, 3525822, 3532255, 3538689, 3545123, 3551557,
    3557991, 3564425, 3570859, 3577293, 3583727, 3590161, 3596595, 3603029,
    3609463, 3615897, 3622331, 3628765, 3635199, 3641633, 3648067, 3654501,
    3660935, 3667369, 3673803, 3680237, 3686671, 3693105, 3699539, 3705973,
    3712407, 3718841, 3725275, 3731709, 3738143, 3744577, 3751011, 3757445,
    3763879, 3770313, 3776747, 3783181, 3789615, 3796049, 3802483, 3808917,
    3815351, 3821785, 3828219, 3834653, 3841087, 3847521, 3853955, 3860389,
    3866823, 3873257, 3879690, 3886124, 3892558, 3898992, 3905426, 3911860,
    3918294, 3924728, 3931162, 3937596, 3944030, 3950464, 3956898, 3963332,
    3969766, 3976200, 3982634, 3989068, 3995502, 4001936, 4008370, 4014804,
    4021238, 4027672, 4034106, 4040540, 4046974, 4053408, 4059842, 4066276,
    4072710, 4079144, 4085578, 4092012, 4098446, 4104880, 4111314, 4117748,
    4124182, 4130616, 4137050, 4143484, 4149918, 4156352, 4162786, 4169220,
    4175654, 4182088, 4188522, 4194956, 4201390, 4207824, 4214258, 4220692,
    4227126, 4233559, 4239993, 4246427, 4252861, 4259295, 4265729, 4272163,
    4278597, 4285031, 4291465, 4297899, 4304333, 4310767, 4317201, 4323635,
    4330069, 4336503, 4342937, 4349371, 4355805, 4362239, 4368673, 4375107,
    4381541, 4387975, 4394409, 4400843, 4407277, 4413711, 4420145, 4426579,
    4433013, 4439447, 4445881, 4452315, 4458749, 4465183, 4471617, 4478051,
    4484485, 4490919, 4497353, 4503787, 4510221, 4516655, 4523089, 4529523,
    4535957, 4542391, 4548825, 4555259, 4561693, 4568127, 4574561, 4580995,
    4587428, 4593862, 4600296, 4606730, 4613164, 4619598, 4626032, 4632466,
    4638900, 4645334, 4651768, 4658202, 4664636, 4671070, 4677504, 4683938,
    4690372, 4696806, 4703240, 4709674, 4716108, 4722542, 4728976, 4735410,
    4741844, 4748278, 4754712, 4761146, 4767580, 4774014, 4780448, 4786882,
    4793316, 4799750, 4806184, 4812618, 4819052, 4825486, 4831920, 4838354,
    4844788, 4851222, 4857656, 4864090, 4870524, 4876958, 4883392, 4889826,
    4896260, 4902694, 4909128, 4915562, 4921996, 4928430, 4934864, 4941297,
    4947731, 4954165, 4960599, 4967033, 4973467, 4979901, 4986335, 4992769,
    4999203, 5005637, 5012071, 5018505, 5024939, 5031373, 5037807, 5044241,
    5050675, 5057109, 5063543, 5069977, 5076411, 5082845, 5089279, 5095713,
    5102147, 5108581, 5115015, 5121449, 5127883, 5134317, 5140751, 5147185,
    5153619, 5160053, 5166487, 5172921, 5179355, 5185789, 5192223, 5198657,
    5205091, 5211525, 5217959, 5224393, 5230827, 5237261, 5243695, 5250129,
    5256563, 5262997, 5269431, 5275865, 5282299, 5288733, 5295166, 5301600,
    5308034, 5314468, 5320902, 5327336, 5333770, 5340204, 5346638, 5353072,
    5359506, 5365940, 5372374, 5378808, 5385242, 5391676, 5398110, 5404544,
    5410978, 5417412, 5423846, 5430280, 5436714, 5443148, 5449582, 5456016,
    5462450, 5468884, 5475318, 5481752, 5488186, 5494620, 5501054, 5507488,
    5513922, 5520356, 5526790, 5533224, 5539658, 5546092, 5552526, 5558960,
    5565394, 5571828, 5578262, 5584696, 5591130, 5597564, 5603998, 5610432,
    5616866, 5623300, 5629734, 5636168, 5642601, 5649035, 5655469, 5661903,
    5668337, 5674771, 5681205, 5687639, 5694073, 5700507, 5706941, 5713375,
    5719809, 5726243, 5732677, 5739111, 5745545, 5751979, 5758413, 5764847,
    5771281, 5777715, 5784149, 5790583, 5797017, 5803451, 5809885, 5816319,
    5822753, 5829187, 5835621, 5842055, 5848489, 5854923, 5861357, 5867791,
    5874225, 5880659, 5887093, 5893527, 5899961, 5906395, 5912829, 5919263,
    5925697, 5932131, 5938565, 5944999, 5951433, 5957867, 5964301, 5970735,
    5977169, 5983603, 5990037, 5996470, 6002904, 6009338, 6015772, 6022206,
    6028640, 6035074, 6041508, 6047942, 6054376, 6060810, 6067244, 6073678,
    6080112, 6086546, 6092980, 6099414, 6105848, 6112282, 6118716, 6125150,
    6131584, 6138018, 6144452, 6150886, 6157320, 6163754, 6170188, 6176622,
    6183056, 6189490, 6195924, 6202358, 6208792, 6215226, 6221660, 6228094,
    6234528, 6240962, 6247396, 6253830, 6260264, 6266698, 6273132, 6279566,
    6286000, 6292434, 6298868, 6305302, 6311736, 6318170, 6324604, 6331038,
    6337472, 6343906, 6350339, 6356773, 6363207, 6369641, 6376075, 6382509,
    6388943, 6395377, 6401811, 6408245, 6414679, 6421113, 6427547, 6433981,
    6440415, 6446849, 6453283, 6459717, 6466151, 6472585, 6479019, 6485453,
    6491887, 6498321, 6504755, 6511189, 6517623, 6524057, 6530491, 6536925,
    6543359, 6549793, 6556227, 6562661, 6569095, 6575529, 6581963 };

  memcpy(&thRadFxp[0], &iv[0], 1024U * sizeof(int32_t));
}

/*
 * File trailer for ref_sin_fixpt.c
 *
 * [EOF]
 */
